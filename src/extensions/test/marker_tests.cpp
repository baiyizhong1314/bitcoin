#include "extensions/core/modifications/marker.h"
#include "extensions/core/transactions.h"

#include "utilstrencodings.h"

#include "primitives/transaction.h"
#include "base58.h"
#include "chain.h"
#include "core_io.h"
#include "uint256.h"

#include <stdio.h>
#include <vector>

#include <boost/test/unit_test.hpp>

BOOST_AUTO_TEST_SUITE(transaction_marker_tests)

BOOST_AUTO_TEST_CASE(exodus_marker_test)
{
    CTransaction txMarker;
    DecodeHexTx(txMarker, "010000000216a1f8cd7af4668022d7618ebef6688120fa380b9a9dc7a98b12f20c484f3101000000008b483045022100a1f16d3479b5685eb4781c7096b8f6e9df0acb81f46fb364667527a3365e9fd10220075fc3ac00087dd7515580eb37bd21e6268672a971f07cc38d7de5108e89324a014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff50450ae4968c223703bd045c122ba642a8532dc84fce9cd8649753b38103a041000000008b483045022100c4472d825a3767d179c18c649b647eaa930f51c6a6bc8f964af40b03db651e5902200d342a36b1a701b0b29e56701ac21c2f159c76f83ecbdd9bccdca0fe5e82e70f014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff040c0300000000000067514104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73d210202be80a0ca69c0e000b97d507f45b9a93bf58fec6650b64ff70e6ffccc3e6d0e52aeb0250300000000001976a914fa0692278afe508514b5ffee8fe5e97732ce066988ac22020000000000001976a914cd254da70858341d27752b598bc99a324c840e7988ac22020000000000001976a914946cb2e08075bcbaf157e47bcb67eb2b2339d24288ac00000000");

    CTransaction txNoMarker;
    DecodeHexTx(txNoMarker, "010000000216a1f8cd7af4668022d7618ebef6688120fa380b9a9dc7a98b12f20c484f3101000000008b483045022100a1f16d3479b5685eb4781c7096b8f6e9df0acb81f46fb364667527a3365e9fd10220075fc3ac00087dd7515580eb37bd21e6268672a971f07cc38d7de5108e89324a014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff50450ae4968c223703bd045c122ba642a8532dc84fce9cd8649753b38103a041000000008b483045022100c4472d825a3767d179c18c649b647eaa930f51c6a6bc8f964af40b03db651e5902200d342a36b1a701b0b29e56701ac21c2f159c76f83ecbdd9bccdca0fe5e82e70f014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff040c0300000000000067514104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73d210202be80a0ca69c0e000b97d507f45b9a93bf58fec6650b64ff70e6ffccc3e6d0e52aeb0250300000000001976a914fa0692278afe508514b5ffee8fe5e97732ce066988ac22020000000000001976a914cd254da70858341d27752b598bc99a324c840e7988ac22020000000000001976a91462e907b15cbf27d5425399ebf6f0fb50ebb88f1888ac00000000");

    BOOST_CHECK(HasExodusMarker(txMarker));
    BOOST_CHECK(!HasExodusMarker(txNoMarker));
}

BOOST_AUTO_TEST_CASE(sender_by_sum_test)
{
    CTransaction txMarker;
    DecodeHexTx(txMarker, "010000000216a1f8cd7af4668022d7618ebef6688120fa380b9a9dc7a98b12f20c484f3101000000008b483045022100a1f16d3479b5685eb4781c7096b8f6e9df0acb81f46fb364667527a3365e9fd10220075fc3ac00087dd7515580eb37bd21e6268672a971f07cc38d7de5108e89324a014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff50450ae4968c223703bd045c122ba642a8532dc84fce9cd8649753b38103a041000000008b483045022100c4472d825a3767d179c18c649b647eaa930f51c6a6bc8f964af40b03db651e5902200d342a36b1a701b0b29e56701ac21c2f159c76f83ecbdd9bccdca0fe5e82e70f014104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73dffffffff040c0300000000000067514104fcf07bb1222f7925f2b7cc15183a40443c578e62ea17100aa3b44ba66905c95d4980aec4cd2f6eb426d1b1ec45d76724f26901099416b9265b76ba67c8b0b73d210202be80a0ca69c0e000b97d507f45b9a93bf58fec6650b64ff70e6ffccc3e6d0e52aeb0250300000000001976a914fa0692278afe508514b5ffee8fe5e97732ce066988ac22020000000000001976a914cd254da70858341d27752b598bc99a324c840e7988ac22020000000000001976a914946cb2e08075bcbaf157e47bcb67eb2b2339d24288ac00000000");

    std::string sender;
    printf("Get Sender: %d\n", (int)GetSenderByContribution(txMarker.vout, sender));
}

BOOST_AUTO_TEST_SUITE_END()

